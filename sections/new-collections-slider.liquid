
{{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}

<style>
  .nc-swiper--{{ section.id }}{
    margin-top: {{ section.settings.margin_top }}px;
    margin-bottom: {{ section.settings.margin_bottom }}px;
  }
  .new-collections-slider{
    margin-top: 50px;
    max-width: 100vw;
    overflow: hidden;
  }
  .ncs-header {
    display: grid;
    grid-template-columns: auto 1fr 130px;
    align-items: center;
    justify-items: center;
  }
  .ncs-pagination {
    display: flex;
    gap: 10px;
    align-items: center;
  }
  .ncs-pagination div:empty{
    display: block ;
  }
  .ncs-pagination div{
    position: inherit;
    width: 48px;
    height: 48px;
    margin-top: inherit;
  }
  .ncs-pagination div:after{
    content: inherit;
  }
  .new-collections-slider .grid{
    column-gap: inherit;
    row-gap: inherit;
    flex-wrap: nowrap;
    margin-top: 37px;
  }
  .new-collections-slider .grid__item {
    width: 100%;
    max-width: 100%;
  }
  .ncs-filter-wrapper{
    border-radius: 12.819px;
    border: 1px solid #78C043;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .ncw-filter-btn {
    border: none;
    margin: 0;
    display: inline-block;
    height: 46px;
    line-height: 46px;
    padding: 0 34px;
    color: #1A1A1B;
    text-align: center;
    font-size: 20px;
    font-style: normal;
    font-weight: 400;
    cursor: pointer;
    background: transparent;
  }
  .ncs-active{
    background: #78C043;
    color: #FFF;
    text-align: center;
    font-size: 20px;
    font-style: normal;
    font-weight: 700;
  }
  .ncs-section-title{
    color: #000;
    font-size: 48px;
    font-style: normal;
    font-weight: 700;
    line-height: 56px;
    margin: 0;
  }

  .ncsSwiper .swiper-slide{
    height: unset;
  }
  @media screen and (min-width: 768px){
    .ncs-pagination{
      margin-left: 20px;
    }
  }
  @media(max-width: 768px) {
      .nc-swiper--{{ section.id }}{
        margin-top: {{ section.settings.margin_top-m }}px;
        margin-bottom: {{ section.settings.margin_bottom-m }}px;
      }
    .ncsSwiper{
      padding-bottom: 48px;
      overflow: visible;
      position: relative;
    }
    .ncs-header {
      display: grid;
      grid-template-columns: 1fr;
      align-items: center;
      justify-items: center;
    }
    .ncs-pagination {
/*       position: absolute;
      bottom: 48px; */
    }
    .ncs-section-title {
      font-size: 24px;
      line-height: 30px;
      margin-bottom: 16px;
    }
    .ncw-filter-btn {
      height: 38px;
      line-height: 38px;
      font-size: 14px;
      padding: 0 30px;
    }
    .new-collections-slider .grid{
      margin-top: 25px;
    }

    .ncs-pagination div{
      position: absolute;
      width: 48px;
      height: 48px;
      margin-top: inherit;
      bottom: 0;
      top: inherit;
      transform: translateX(-50%);
    }
    .ncs-pagination .ncs-prev{
      left: calc(50% - 30px);
    }
    .ncs-pagination .ncs-next{
      left: calc(50% + 30px);
    }
  }
</style>

{% liquid
  assign collections = section.settings.collection_list
  assign collection = collections | first
%}
<nc-swiper>
  <div class="nc-swiper--{{ section.id }} {% unless section.settings.full_width %}page-width{% endunless %}">
    <div class="swiper ncsSwiper">
      <div class="ncs-header">
        <h2 class="ncs-section-title">JUST ARRIVED</h2>
        <div class="ncs-filter-wrapper">
          {% for collection in collections %}
            <button class="ncw-filter-btn {% if forloop.first %}ncs-active{% endif %}" type="button" data-url="{{ collection.url }}">{{ collection.title }}</button>
          {% endfor %}
        </div>
        <div class="ncs-pagination">
          <div class="swiper-button-prev ncs-prev">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="49" viewBox="0 0 48 49" fill="none">
              <rect x="-0.5" y="0.5" width="47" height="47" rx="5.5" transform="matrix(-1 0 0 1 47 0.863281)" stroke="#78C043"/>
              <path d="M14.1464 25.2168C13.9512 25.0216 13.9512 24.705 14.1464 24.5097L17.3284 21.3277C17.5237 21.1325 17.8403 21.1325 18.0355 21.3277C18.2308 21.523 18.2308 21.8396 18.0355 22.0349L15.2071 24.8633L18.0355 27.6917C18.2308 27.887 18.2308 28.2036 18.0355 28.3988C17.8403 28.5941 17.5237 28.5941 17.3284 28.3988L14.1464 25.2168ZM34 25.3633H14.5V24.3633H34V25.3633Z" fill="#78C043"/>
            </svg>
          </div>
          <div class="swiper-button-next ncs-next">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="49" viewBox="0 0 48 49" fill="none">
              <rect x="0.5" y="1.36328" width="47" height="47" rx="5.5" stroke="#78C043"/>
              <path d="M33.8536 25.2168C34.0488 25.0216 34.0488 24.705 33.8536 24.5097L30.6716 21.3277C30.4763 21.1325 30.1597 21.1325 29.9645 21.3277C29.7692 21.523 29.7692 21.8396 29.9645 22.0349L32.7929 24.8633L29.9645 27.6917C29.7692 27.887 29.7692 28.2036 29.9645 28.3988C30.1597 28.5941 30.4763 28.5941 30.6716 28.3988L33.8536 25.2168ZM14 25.3633H33.5V24.3633H14V25.3633Z" fill="#78C043"/>
            </svg>
          </div>
        </div>
      </div>
      <ul class="swiper-wrapper grid" id="product-grid">
          {% for product in collection.products %}
            {% assign lazy_load = false %}
            {%- if forloop.index > 2 -%}
              {%- assign lazy_load = true -%}
            {%- endif -%}
            
              <li class="swiper-slide grid__item">
                {% render 'card-product',
                  card_product: product,
                  media_aspect_ratio: section.settings.image_ratio,
                  image_shape: section.settings.image_shape,
                  show_secondary_image: section.settings.show_secondary_image,
                  show_vendor: section.settings.show_vendor,
                  show_rating: section.settings.show_rating,
                  lazy_load: lazy_load,
                  show_quick_add: section.settings.enable_quick_add,
                  section_id: section.id
                %}
              </li>
         
          {% endfor %}
      </ul>
    </div>
  </div>
</nc-swiper>
<script>
  new Swiper(".ncsSwiper", {
    slidesPerView: 4,
    spaceBetween: 15,
    navigation: {
      nextEl: ".ncs-next",
      prevEl: ".ncs-prev",
    },
    breakpoints: {
      // when window width is >= 320px
      320: {
        slidesPerView: 1.4,
        spaceBetween: 10
      },
      // when window width is >= 480px
      480: {
        slidesPerView: 1.5,
        spaceBetween: 20
      },
      // when window width is >= 640px
      640: {
        slidesPerView: 2.5,
        spaceBetween: 20
      },
      1200: {
        slidesPerView: 4,
        spaceBetween: 20
      }
    }
  })

  class NewCollection extends HTMLElement{
    constructor() {
      super()
      this.btns = this.querySelectorAll(".ncw-filter-btn")
      this.btns.forEach(btn => btn.addEventListener("click", this.debounce((event) => {
        this.handleClickEvent(event);
      }, 300).bind(this)))
    }

    handleClickEvent(e) {
      e.preventDefault()
      this.handleActiveBtn(e)
      this.url = e.target.dataset.url
      this.renderPage()
    }

    handleActiveBtn(e) {
      this.btns.forEach(btn => {
        if(btn.dataset.url === e.target.dataset.url) btn.classList.add("ncs-active")
        else btn.classList.remove("ncs-active")
      })
    }

    renderPage() {
      fetch(this.url)
      .then(res => res.text())
      .then(res => {
        this.querySelector("#product-grid").innerHTML = new DOMParser().parseFromString(res, 'text/html').querySelector("#product-grid").innerHTML
      })
      .catch(err => console.log(err))
    }

    debounce(fn, wait) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn.apply(this, args), wait);
      };
    }
  }

  customElements.define("nc-swiper", NewCollection)
</script>

{% schema %}
  {
    "name": "New Collections Slider",
    "class": "new-collections-slider",
    "templates": ["index"],
    "settings": [
      {
        "type": "checkbox",
        "id": "full_width",
        "label": "Full Width Section",
        "default": false
      },
      {
        "type": "collection_list",
        "id": "collection_list",
        "label": "Collections",
        "limit": 3
      },
      {
        "type": "header",
        "content": "t:sections.main-collection-product-grid.settings.header__3.content"
      },
      {
        "type": "select",
        "id": "image_ratio",
        "options": [
          {
            "value": "adapt",
            "label": "t:sections.main-collection-product-grid.settings.image_ratio.options__1.label"
          },
          {
            "value": "portrait",
            "label": "t:sections.main-collection-product-grid.settings.image_ratio.options__2.label"
          },
          {
            "value": "square",
            "label": "t:sections.main-collection-product-grid.settings.image_ratio.options__3.label"
          }
        ],
        "default": "adapt",
        "label": "t:sections.main-collection-product-grid.settings.image_ratio.label"
      },
      {
        "type": "select",
        "id": "image_shape",
        "options": [
          {
            "value": "default",
            "label": "t:sections.all.image_shape.options__1.label"
          },
          {
            "value": "arch",
            "label": "t:sections.all.image_shape.options__2.label"
          },
          {
            "value": "blob",
            "label": "t:sections.all.image_shape.options__3.label"
          },
          {
            "value": "chevronleft",
            "label": "t:sections.all.image_shape.options__4.label"
          },
          {
            "value": "chevronright",
            "label": "t:sections.all.image_shape.options__5.label"
          },
          {
            "value": "diamond",
            "label": "t:sections.all.image_shape.options__6.label"
          },
          {
            "value": "parallelogram",
            "label": "t:sections.all.image_shape.options__7.label"
          },
          {
            "value": "round",
            "label": "t:sections.all.image_shape.options__8.label"
          }
        ],
        "default": "default",
        "label": "t:sections.all.image_shape.label",
        "info": "t:sections.all.image_shape.info"
      },
      {
        "type": "checkbox",
        "id": "show_secondary_image",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.show_secondary_image.label"
      },
      {
        "type": "checkbox",
        "id": "show_vendor",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.show_vendor.label"
      },
      {
        "type": "checkbox",
        "id": "show_rating",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.show_rating.label",
        "info": "t:sections.main-collection-product-grid.settings.show_rating.info"
      },
      {
        "type": "checkbox",
        "id": "enable_quick_add",
        "default": false,
        "label": "t:sections.main-collection-product-grid.settings.enable_quick_buy.label"
      },
      {
        "type": "header",
        "content": "Spacing"
      },
      {
        "type": "range",
        "id": "margin_top",
        "min": 0,
        "max": 200,
        "step": 4,
        "unit": "px",
        "label": "Margin Top",
        "default": 16
      },
      {
        "type": "range",
        "id": "margin_bottom",
        "min": 0,
        "max": 200,
        "step": 4,
        "unit": "px",
        "label": "Margin Bottom",
        "default": 16
      },
      {
        "type": "range",
        "id": "margin_top-m",
        "min": 0,
        "max": 200,
        "step": 4,
        "unit": "px",
        "label": "Margin Top (Mobile)",
        "default": 16
      },
      {
        "type": "range",
        "id": "margin_bottom-m",
        "min": 0,
        "max": 200,
        "step": 4,
        "unit": "px",
        "label": "Margin Bottom (Mobile)",
        "default": 16
      }
    ],
    "blocks": [],
    "presets": [
      {
        "name": "New Collections Slider"
      }
    ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}